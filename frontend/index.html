<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Meeting Assistant</title>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      width: 100%;
      margin: 30px auto;
      padding: 30px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      border: 1px solid #e9ecef;
    }
    h1 {
      text-align: center;
      color: #343a40;
      margin-bottom: 25px;
      font-size: 1.8rem;
    }
    section {
      margin: 25px 0;
    }
    h2 {
      margin-bottom: 12px;
      color: #495057;
      font-size: 1.3rem;
      border-bottom: 2px solid #007bff;
      padding-bottom: 5px;
    }
    #videoUpload {
      width: 100%;
      padding: 8px;
    }
    textarea {
      width: 100%;
      box-sizing: border-box; /* Ensures padding doesn't affect width */
      height: 200px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ced4da;
      resize: vertical;
      font-size: 14px;
      line-height: 1.6;
      background-color: #f8f9fa;
    }
    textarea:focus {
      border-color: #80bdff;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    }
    button {
      margin-top: 12px;
      padding: 12px 24px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: background-color 0.2s ease-in-out;
    }
    button:hover {
      background-color: #0056b3;
    }
    .upload-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 2px dashed #007bff;
        padding: 20px;
        border-radius: 8px;
        background-color: #f0f8ff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Automated Meeting Transcript & MOM Generator 🤖</h1>

    <section class="upload-section">
      <h2>1. Upload Zoom Recording</h2>
      <input type="file" id="videoUpload" accept="video/*,audio/*">
      <button id="processBtn">Generate Transcript & MOM</button>
    </section>

    <section class="transcript-section">
      <h2>2. Meeting Transcript</h2>
      <textarea id="transcriptBox" readonly placeholder="Your meeting transcript will appear here..."></textarea>
    </section>

    <section class="mom-section">
      <h2>3. Minutes of Meeting (Editable)</h2>
      <textarea id="momBox" placeholder="The AI-generated Minutes of Meeting will appear here..."></textarea>
      <button id="downloadPdf">Download MOM as PDF</button>
    </section>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const backendURL = "http://127.0.0.1:8000/transcribe";

    // Handle transcription and MOM generation
    document.getElementById("processBtn").addEventListener("click", async () => {
      const fileInput = document.getElementById("videoUpload");
      if (!fileInput.files.length) {
        alert("Please upload a video or audio file first!");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      // Show loading messages
      document.getElementById("transcriptBox").value = "Transcribing with Deepgram... Please wait, this may take a moment. ⏳";
      document.getElementById("momBox").value = "Waiting for transcript to generate MOM with Gemini...";

      try {
        const response = await fetch(backendURL, {
          method: "POST",
          body: formData
        });

        // Check if the server responded with an error
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        // Check if we received the transcript and mom
        if (data.transcript && data.mom) {
          document.getElementById("transcriptBox").value = data.transcript;
          document.getElementById("momBox").value = data.mom; // Directly use the AI-generated MOM
        } else {
          document.getElementById("transcriptBox").value = "Error: Invalid data received from backend. " + JSON.stringify(data);
          document.getElementById("momBox").value = "Could not generate MOM.";
        }
      } catch (error) {
        console.error("Error:", error);
        document.getElementById("transcriptBox").value = "An error occurred: " + error.message;
        document.getElementById("momBox").value = "Failed to generate MOM. Please see the transcript box for error details.";
      }
    });

    // Download MOM as PDF
    document.getElementById("downloadPdf").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const momText = document.getElementById("momBox").value;
      
      if (!momText) {
          alert("There is no content to download!");
          return;
      }

      doc.setFont("helvetica");
      doc.setFontSize(12);
      
      // jsPDF requires splitting the text to handle page breaks automatically
      const splitText = doc.splitTextToSize(momText, 180); // 180 is the width of the text block
      doc.text(splitText, 10, 10);

      doc.save("Minutes_of_Meeting.pdf");
    });
  </script>
</body>
</html>